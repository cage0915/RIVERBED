---
interface Tag {
  name: string;
  x: number;
  y: number;
}

interface Photo {
  id: string;
  r2Key: string;
  tags: Tag[];
}

interface Props {
  photo: Photo;
}

const { photo } = Astro.props;

// Determine image source based on environment
const useLocal = import.meta.env.PUBLIC_USE_LOCAL_PHOTOS === 'true';
const imageSrc = useLocal
  ? `/local-photos/${photo.r2Key}`
  : `/api/image/${photo.r2Key}`;
---

<div class="relative group overflow-hidden bg-zinc-900">
  <!-- Image -->
  <img
    src={imageSrc}
    alt={`Photo ${photo.id}`}
    class="w-full h-auto aspect-[16/9] object-cover transition-transform duration-700 ease-in-out opacity-90 group-hover:opacity-100"
    loading="lazy"
  />

  <!-- Overlay -->
  <div
    class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"
  >
    <!-- Tags Container -->
    <div class="relative w-full h-full">
      {
        photo.tags.map((tag) => (
          <div
            class="absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center pointer-events-auto"
            style={`left: ${tag.x}%; top: ${tag.y}%;`}
          >
            <!-- Marker point -->
            <div class="w-2 h-2 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)]" />

            <!-- Label (always visible when overlay is shown) -->
            <div class="mt-2">
               <span class="bg-black/60 text-white text-[10px] tracking-wider uppercase font-medium px-2 py-1 backdrop-blur-md border border-white/10 whitespace-nowrap shadow-xl">
                {tag.name}
              </span>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</div>
